print(1)
}
for (i in 1:length(sce0$contigs)){
if(sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[1]=='TRB'){
}
}
for (i in 1:length(sce0$contigs)){
if(sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[1]=='TRB'){
print(i)
}
}
for (i in 1:length(sce0$contigs)){
if(sce0$contigs[[i]]$chain[1]=='TRA' && sce0$contigs[[i]]$chain[1]=='TRB'){
print(i)
}
}
for (i in 1:length(sce0$contigs)){
if(sce0$contigs[[i]]$chain[1]=='TRA' && sce0$contigs[[i]]$chain[2]=='TRB'){
print(i)
}
}
sce0$contigs[[994]]$chain[1]=='TRA'
sce0$contigs[[994]]$chain
for (i in 1:length(sce0$contigs)){
if(sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[2]=='TRB'){
print(i)
}
}
i=994
sce0$contigs[[i]]$chain[2]=='TRB'
sce0$contigs[[i]]$cdr3[2]
sce0$contigs[[i]]$cdr3[1]
tem=c(sce0$contigs[[i]]$cdr3[1],sce0$contigs[[i]]$cdr3[2])
tem
a=c(1:10)
a
a[1]=tempdir()
a[1]=tem
rv1 <- c(10, 20, 30, 40)
rv2 <- append(rv1, 50, after = 40)
print(rv2)
a
a<-append(a,tem)
a
a[12]
a[11]
sce <- clonoStats(sce0$contigs, method = 'EM')
sce
sce0[[994]]
sce0$contigs[[i]]
sce0$contigs[[i]][1]
sce0$contigs[[i]][1][1]
sce0$contigs[[i]][[1]]
type(sce0$contigs[[i]])
type(sce0$contigs[[994]])
type(sce0$contigs[[994]][1])
class(sce0$contigs[[994]][1])
class(sce0$contigs[[994]])
class(sce0$contigs)
class(sce0$contigs[[994]])
sce0$contigs[[994]]
sce0$contigs[[994]][[1]]
sce0$contigs[[994]][[2]]
sce0$contigs[[994]][1,]
rbind(sce0$contigs[[994]][1,],sce0$contigs[[994]][1,])
rbind(sce0$contigs[[994]][1,],sce0$contigs[[994]][2,])
rbind(sce0$contigs[[994]][1,],sce0$contigs[[994]][2,])==sce0$contigs[[994]]
a=rbind(sce0$contigs[[994]][1,],sce0$contigs[[994]][2,])
class(a)
class(sce0$contigs)
sce0$contigs[1]
sce0$contigs[2]
sce0$contigs[1001]
sce0$contigs[1000]
sce0$contigs[994]
class(sce0$contigs[994])
sce0$contigs[994][1,]
sce0$contigs[994][2,]
sce0$contigs[994][1,][1]
sce0$contigs[994][1,][1,]
class(sce0$contigs[994])
samplePool=c()
for (i in 1:length(sce0$contigs)){
if(length(sce0$contigs[[i]]$chain)==2 & sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[2]=='TRB'){
temp=c(sce0$contigs[[i]]$cdr3[1],sce0$contigs[[i]]$cdr3[2])
samplePool
}
}
a=CompressedSplitDFrameList()
a=SplitDFrameList()
a=DataFrameList()
a=DataFrameList(sce0$contigs[[994]])
a
a[1]
a[[1]]
a[[1]][1,]
a=DataFrameList()
a=rbind(a,sce0$contigs[[994]])
a
a=DataFrameList(sce0$contigs[[994]])
a=rbind(a,a)
a
a[[1]]
a
a[1,drop]
a
a[[1]]
a[[2]]=sce0$contigs[[i]]
a
a[[2]]
samplePool=DataFrameList()
index=1
for (i in 1:length(sce0$contigs)){
if(length(sce0$contigs[[i]]$chain)==2 & sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[2]=='TRB'){
samplePool[[index]]=sce0$contigs[[i]]
index=index+1
}
}
samplePool
samplePool[[1]]
EMstats <- clonoStats(samplePool, method = "EM")
EMstats <- clonoStats(sce0$contigs, method = "EM")
class(sce0$contigs)
class(samplePool)
class(sce0$contigs[[i]])
sce0$contigs[[i]]<-sce0$contigs[[i]] %>% filter(chain %in% ["TRA","TRB"])
sce0$contigs[[i]]<-sce0$contigs[[i]] %>% filter(chain %in% c("TRA","TRB"))
library(dyplr)
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
sce0$contigs[[i]]<-sce0$contigs[[i]] %>% filter(chain %in% c("TRA","TRB"))
sce0$contigs[[994]]<-sce0$contigs[[994]][filter(chain %in% c("TRA","TRB")]
sce0$contigs[[994]]<-sce0$contigs[[994]][filter(chain %in% c("TRA","TRB"),]
sce0$contigs[[i]]<-sce0$contigs[[i]][order(sce0$contigs[[i]]$chain),]
sce0$contigs[[994]]<-sce0$contigs[[994]][filter(sce0$contigs[[994]]$chain %in% c("TRA","TRB"),]
class(sce0$contigs[[i]])
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
getPoisson<-function(){
a=-1
while(a<0 | a>4){
a=rpois(1, 1)
}
return a
}
getPoisson<-function(){
a=-1
while(a<0 | a>4){
a=rpois(1, 1)
}
return(a)
}
getPoisson
getPoisson()
getPoisson()
getPoisson()
a=getPoisson()
a
a[1]
a[[1]]
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1, 1)
rpois(1)
runif(1, 1, 141)
runif(1, 1, 141)
runif(1, 1, 141)
runif(1, 1, 141)
sample.int(141, 10)
sample.int(1, 10)
sample.int(2, 10)
sample.int(2, 10, replace=TRUE)
sample.int(2, replace=TRUE)
sample.int(4, replace=TRUE)
sample.int(141, 1, replace=TRUE)
sample.int(141, 1, replace=TRUE)
samplePool[[1]]
samplePool[[1]][1,]
class(samplePool[[1]][1,])
class(samplePool[[1]])
a=DFrame()
a=DataFrame()
a
rbind(a,samplePool[[1]])
a=rbind(a,samplePool[[1]])
class(a)
getPoisson<-function(){
a=-1
while(a<0 | a>4){
a=rpois(1, 1)
}
return(a)
}
getClonotype<-function(){
numberA=getPoisson()
numberB=getPoisson()
result=DataFrame()
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
if (numberB>=1){
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
while(numberA>0 | numberB>0){
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
else{
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
}
return(result)
}
a=getClonotype()
poolSize=141
getPoisson<-function(){
a=-1
while(a<0 | a>4){
a=rpois(1, 1)
}
return(a)
}
getClonotype<-function(){
numberA=getPoisson()
numberB=getPoisson()
result=DataFrame()
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
if (numberB>=1){
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
while(numberA>0 | numberB>0){
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
else{
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
}
return(result)
}
a=getClonotype()
a
getClonotype()
SampleSize=500
sample=DataFrame()
sample[1]=getClonotype()
SampleSize=500
sample=DataFrameList()
sample[1]=getClonotype()
sample[[1]]=getClonotype()
sample
sample[[1]]
sample[[5]]=getClonotype()
SampleSize=500
sample=DataFrameList()
for(i in 1:SampleSize){
sample[[i]]=getClonotype()
}
sample
sample[[500]]
EMstats <- clonoStats(sample, method = "EM")
class(sce0)
class(sce0$contigs)
sample
sample
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
sce0 <- readRDS('toyTCRdata.rds')
sce <- clonoStats(sce0, method = 'EM')
# metadata(sce)$clonoStats
# clonoAbundance(sce)
# clonoFrequency(sce)
# EMstats <- clonoStats(sce, method = "EM")
#
# EMstats2=metadata(EMstats)$clonoStats
# barVDJ(EMstats2, title = "contigs", legend = TRUE)
# abundanceVDJ(EMstats2)
#A<-sce0$contigs[sce0$contigs[, 'chain'] %in% c('TRA','TRB')]
for (i in 1:length(sce0$contigs)){
#sce0$contigs[[i]]  "DFrame"  "S4Vectors"
#sce0$contigs[[i]]<-sce0$contigs[[i]] %>% filter(chain %in% c("TRA","TRB"))
#sce0$contigs[[i]]<-sce0$contigs[[i]][filter(sce0$contigs[[i]]$chain %in% c("TRA","TRB")),]
sce0$contigs[[i]]<-sce0$contigs[[i]][order(sce0$contigs[[i]]$chain),]
}
samplePool=DataFrameList()
poolSize=1
for (i in 1:length(sce0$contigs)){
if(length(sce0$contigs[[i]]$chain)==2 & sce0$contigs[[i]]$chain[1]=='TRA' & sce0$contigs[[i]]$chain[2]=='TRB'){
samplePool[[poolSize]]=sce0$contigs[[i]]
poolSize=poolSize+1
}
}
poolSize=poolSize-1
getPoisson<-function(){
a=-1
while(a<0 | a>4){
a=rpois(1, 1)
}
return(a)
}
getClonotype<-function(){
numberA=getPoisson()
numberB=getPoisson()
result=DataFrame()
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
if (numberB>=1){
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
while(numberA>0 | numberB>0){
indexInPool=sample.int(poolSize, 1, replace=TRUE)
if (numberA>=1){
result=rbind(result,samplePool[[indexInPool]][1,])
numberA=numberA-1
}
else{
result=rbind(result,samplePool[[indexInPool]][2,])
numberB=numberB-1
}
}
if(length(result$barcode)){
for(i in 1:length(result$barcode)){
result$barcode[i]=result$barcode[1]
result$sample[i]='sim'
}
}
return(result)
}
SampleSize=50
getSample<-function(samplesize){
sample=DataFrame()
for(i in 1:samplesize){
sample=rbind(sample,getClonotype())
}
samplelist<-split(sample,sample$barcode)
# sample1<-as(sample,'SplitDFrameList')
return(samplelist)
}
# samplelist=getSample(SampleSize)
# EMpredicted <- clonoStats(samplelist, method = 'EM')
#UNpredicted <- clonoStats(samplelist, method = 'unique')
TruthPercentageMap=hashmap()
for(i in 1:poolSize){
key=paste(samplePool[[i]]$cdr3[1],samplePool[[i]]$cdr3[2],sep=' ')
if(is.null(TruthPercentageMap[[key]])){
TruthPercentageMap[[key]]<-1/poolSize
}
else{
TruthPercentageMap[[key]]<-TruthPercentageMap[[key]]+1/poolSize
}
}
getDistance<-function(predicted){
clonotypes=clonoNames(predicted)
abundance=clonoAbundance(predicted)
SumAbundance=sum(abundance)
distance=0
seen <- hashmap()
for(i in 1:length(abundance)){
if(is.null(TruthPercentageMap[[clonotypes[i]]])){
distance=distance+abundance[i]/SumAbundance
}
else{
seen[[clonotypes[i]]]<-TruthPercentageMap[[clonotypes[i]]]
distance=distance+abs(abundance[i]/SumAbundance-TruthPercentageMap[[clonotypes[i]]])
}
}
distance=distance+Reduce("+", values(TruthPercentageMap)) -Reduce("+", values(seen))
return(distance)
}
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:20){
samplelist=getSample(50)
EMpredicted <- clonoStats(samplelist, method = 'EM')
distance1=getDistance(EMpredicted)
DistanceListFromEM[i]=distance1
# UNpredicted <- clonoStats(samplelist, method = 'unique')
# distance2=getDistance(UNpredicted)
# DistanceListFromUN[i]=distance2
}
View(getClonotype)
View(getDistance)
boxplot(DistanceListFromEM)
barplot(DistanceListFromEM)
clonoNames(predicted)
samplelist=getSample(50)
EMpredicted <- clonoStats(samplelist, method = 'EM')
clonoNames(EMpredicted)
boxplot(DistanceListFromEM)
barplot(DistanceListFromEM)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
sce0 <- readRDS('toyTCRdata.rds')
sce <- clonoStats(sce0, method = 'EM')
# metadata(sce)$clonoStats
# clonoAbundance(sce)
# clonoFrequency(sce)
# EMstats <- clonoStats(sce, method = "EM")
#
# EMstats2=metadata(EMstats)$clonoStats
# barVDJ(EMstats2, title = "contigs", legend = TRUE)
# abundanceVDJ(EMstats2)
DistanceListFromEM
boxplot(DistanceListFromEM)
hist(DistanceListFromEM)
barplot(DistanceListFromEM)
boxplot(DistanceListFromEM)
hist(DistanceListFromEM)
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:20){
samplelist=getSample(50)
EMpredicted <- clonoStats(samplelist, method = 'EM')
distance1=getDistance(EMpredicted)
DistanceListFromEM[i]=distance1
# UNpredicted <- clonoStats(samplelist, method = 'unique')
# distance2=getDistance(UNpredicted)
# DistanceListFromUN[i]=distance2
}
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:10){
samplelist=getSample(200)
EMpredicted <- clonoStats(samplelist, method = 'EM')
distance1=getDistance(EMpredicted)
DistanceListFromEM[i]=distance1
# UNpredicted <- clonoStats(samplelist, method = 'unique')
# distance2=getDistance(UNpredicted)
# DistanceListFromUN[i]=distance2
}
boxplot(DistanceListFromEM)
hist(DistanceListFromEM)
devtools::install_github('kstreet13/VDJdive')
library(devtools)
install.packages("devtools")
library(devtools)
devtools::install_github('kstreet13/VDJdive')
devtools::install_github('kstreet13/VDJdive')
library(VDJdive)
samplelist
EMpredicted <- clonoStats(samplelist, method = 'EM')
EMpredicted <- clonoStats(samplelist, method = 'EM')
UNpredicted <- clonoStats(samplelist, method = 'unique')
