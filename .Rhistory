#time0=Sys.time()
getEvaluationDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
KLDivergenceListFromEM=c()
KLDivergenceListFromUN=c()
JSDivergenceListFromEM=c()
JSDivergenceListFromUN=c()
DistanceListUN_EM=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
KLDivergenceListFromEM[i]=getKLDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
JSDivergenceListFromEM[i]=getJSDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
KLDivergenceListFromUN[i]=getKLDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
JSDivergenceListFromUN[i]=getJSDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
DistanceListUN_EM[i]=getDistanceUN_EM(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1],clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM,KLDivergenceListFromUN,KLDivergenceListFromEM,JSDivergenceListFromUN,JSDivergenceListFromEM,DistanceListUN_EM))
}
ResultDistances=getEvaluationDataFrame(10000L,1000L,10L)
boxplot(ResultDistances$DistanceListFromEM)
hist(ResultDistances$DistanceListFromEM)
boxplot(ResultDistances$DistanceListFromUN)
hist(ResultDistances$DistanceListFromUN)
print(median(ResultDistances$DistanceListFromEM))
print(median(ResultDistances$DistanceListFromUN))
print(mean(ResultDistances$DistanceListFromEM))
print(mean(ResultDistances$DistanceListFromUN))
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
source_python("./main.py")
#time0=Sys.time()
getResultTable <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
updateMergedDataframe(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
updateMergedDataframe(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
result=getIntermediateResult(Times)
clearStorage()
return(result)
}
#Intermediate=getResultTable(200L,500L,1L)
#time0=Sys.time()
getDistanceDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM))
}
ResultDistances=getDistanceDataFrame(200L,500L,1L)
#time0=Sys.time()
getEvaluationDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
KLDivergenceListFromEM=c()
KLDivergenceListFromUN=c()
JSDivergenceListFromEM=c()
JSDivergenceListFromUN=c()
DistanceListUN_EM=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
KLDivergenceListFromEM[i]=getKLDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
JSDivergenceListFromEM[i]=getJSDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
KLDivergenceListFromUN[i]=getKLDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
JSDivergenceListFromUN[i]=getJSDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
DistanceListUN_EM[i]=getDistanceUN_EM(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1],clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM,KLDivergenceListFromUN,KLDivergenceListFromEM,JSDivergenceListFromUN,JSDivergenceListFromEM,DistanceListUN_EM))
}
ResultDistances=getEvaluationDataFrame(10000L,1000L,10L)
boxplot(ResultDistances$DistanceListFromEM)
hist(ResultDistances$DistanceListFromEM)
boxplot(ResultDistances$DistanceListFromUN)
hist(ResultDistances$DistanceListFromUN)
print(median(ResultDistances$DistanceListFromEM))
print(median(ResultDistances$DistanceListFromUN))
print(mean(ResultDistances$DistanceListFromEM))
print(mean(ResultDistances$DistanceListFromUN))
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
source_python("./main.py")
#time0=Sys.time()
getResultTable <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
updateMergedDataframe(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
updateMergedDataframe(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
result=getIntermediateResult(Times)
clearStorage()
return(result)
}
#Intermediate=getResultTable(200L,500L,1L)
#time0=Sys.time()
getDistanceDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM))
}
ResultDistances=getDistanceDataFrame(200L,500L,1L)
#time0=Sys.time()
getEvaluationDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
KLDivergenceListFromEM=c()
KLDivergenceListFromUN=c()
JSDivergenceListFromEM=c()
JSDivergenceListFromUN=c()
DistanceListUN_EM=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
KLDivergenceListFromEM[i]=getKLDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
JSDivergenceListFromEM[i]=getJSDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
KLDivergenceListFromUN[i]=getKLDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
JSDivergenceListFromUN[i]=getJSDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
DistanceListUN_EM[i]=getDistanceUN_EM(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1],clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM,KLDivergenceListFromUN,KLDivergenceListFromEM,JSDivergenceListFromUN,JSDivergenceListFromEM,DistanceListUN_EM))
}
ResultDistances=getEvaluationDataFrame(10000L,1000L,10L)
boxplot(ResultDistances$DistanceListFromEM)
hist(ResultDistances$DistanceListFromEM)
boxplot(ResultDistances$DistanceListFromUN)
hist(ResultDistances$DistanceListFromUN)
print(median(ResultDistances$DistanceListFromEM))
print(median(ResultDistances$DistanceListFromUN))
print(mean(ResultDistances$DistanceListFromEM))
print(mean(ResultDistances$DistanceListFromUN))
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
source_python("./main.py")
#time0=Sys.time()
getResultTable <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
updateMergedDataframe(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
updateMergedDataframe(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
result=getIntermediateResult(Times)
clearStorage()
return(result)
}
#Intermediate=getResultTable(200L,500L,1L)
#time0=Sys.time()
getDistanceDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM))
}
ResultDistances=getDistanceDataFrame(200L,500L,1L)
#time0=Sys.time()
getEvaluationDataFrame <- function(PoolSize,SampleSize,Times){
generateSamplePool(PoolSize)
DistanceListFromEM=c()
DistanceListFromUN=c()
KLDivergenceListFromEM=c()
KLDivergenceListFromUN=c()
JSDivergenceListFromEM=c()
JSDivergenceListFromUN=c()
DistanceListUN_EM=c()
for(i in 1:Times){
sample=getSample(PoolSize,SampleSize)
sample$high_confidence<-as.logical(sample$high_confidence)
sample$productive<-as.logical(sample$productive)
sample$full_length<-as.logical(sample$full_length)
sample$is_cell<-as.logical(sample$is_cell)
samplelist <- split(sample, f = sample$barcode)
samplelist  <- SplitDataFrameList(samplelist)
EMpredicted <- clonoStats(samplelist, method = 'EM')
DistanceListFromEM[i]=getDistance(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
KLDivergenceListFromEM[i]=getKLDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
JSDivergenceListFromEM[i]=getJSDivergence(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
UNpredicted <- clonoStats(samplelist, method = 'unique')
DistanceListFromUN[i]=getDistance(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
KLDivergenceListFromUN[i]=getKLDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
JSDivergenceListFromUN[i]=getJSDivergence(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
DistanceListUN_EM[i]=getDistanceUN_EM(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1],clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
#print(i)
#time1=Sys.time()
#print(time1-time0)
#time0=time1
}
clearStorage()
return(data.frame(DistanceListFromUN,DistanceListFromEM,KLDivergenceListFromUN,KLDivergenceListFromEM,JSDivergenceListFromUN,JSDivergenceListFromEM,DistanceListUN_EM))
}
ResultDistances=getEvaluationDataFrame(10000L,1000L,10L)
boxplot(ResultDistances$DistanceListFromEM)
hist(ResultDistances$DistanceListFromEM)
boxplot(ResultDistances$DistanceListFromUN)
hist(ResultDistances$DistanceListFromUN)
print(median(ResultDistances$DistanceListFromEM))
print(median(ResultDistances$DistanceListFromUN))
print(mean(ResultDistances$DistanceListFromEM))
print(mean(ResultDistances$DistanceListFromUN))
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
2……3
2^3
0.8^(1:poolSize)
poolSize=10000
0.8^(1:poolSize)
a=1:3
b=2:4
max(a,b)
rep(0,10)
rep(1e-7,10)
1e-3
DistributionOfClonotypes=0.8^(1:poolSize)
minimum_bound=rep(1e-7,poolSize)
DistributionOfClonotypes <- pmin(DistributionOfClonotypes, minimum_bound)
DistributionOfClonotypes
DistributionOfClonotypes=0.8^(1:poolSize)
minimum_bound=rep(1e-7,poolSize)
DistributionOfClonotypes <- pmax(DistributionOfClonotypes, minimum_bound)
DistributionOfClonotypes
library(VDJdive)
knitr::opts_chunk$set(echo = TRUE)
# library(VDJdive)
contigs <- readVDJcontigs("sample2")
# library(VDJdive)
contigs <- readVDJ("sample2")
# library(VDJdive)
contigs <- readVDJcontigs("sample2")
contigs
EMpredicted <- clonoStats(contigs, method = 'EM')
EMpredicted <- clonoStats(contigs, method = 'UN')
EMpredicted <- clonoStats(contigs, method = 'unique')
clonoNames(EMpredicted)
clonoAbundance(EMpredicted)[,1]
sample1 <- readVDJcontigs("sample1")
sample2 <- readVDJcontigs("sample2")
EMpredicted1 <- clonoStats(sample1, method = 'unique')
EMpredicted2 <- clonoStats(sample2, method = 'unique')
DISTANCE=getDistanceUN_EM(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
clonoNames(EMpredicted2)
clonoAbundance(EMpredicted1)
DISTANCE=getDistanceUN_EM(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
knitr::opts_chunk$set(echo = TRUE)
getDistanceEM_UN<-function(clonotype1,abundance1,clonotype2,abundance2){
stimulated1<- data.frame(clonotype1,abundance1)
stimulated2<- data.frame(clonotype2,abundance2)
colnames(stimulated1) <- c('clonotype','abundance')
colnames(stimulated2) <- c('clonotype','abundance')
sum_abundance1=sum(stimulated1['abundance'])
sum_abundance2=sum(stimulated2['abundance'])
stimulated1['abundance']=stimulated1['abundance']/sum_abundance1
stimulated2['abundance']=stimulated2['abundance']/sum_abundance2
merged = merge(x = stimulated1, y = stimulated2, by = "clonotype",all = TRUE)
merged[is.na(merged)] <- 0
return (sum(abs(merged['abundance.x']-merged['abundance.y'])))
}
DISTANCE=getDistanceUN_EM(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
DISTANCE=getDistanceEM_UN(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
DISTANCE
getDistanceUN_EM<-function(clonotype1,abundance1,clonotype2,abundance2){
stimulated1<- data.frame(clonotype1,abundance1)
stimulated2<- data.frame(clonotype2,abundance2)
colnames(stimulated1) <- c('clonotype','abundance')
colnames(stimulated2) <- c('clonotype','abundance')
sum_abundance1=sum(stimulated1['abundance'])
sum_abundance2=sum(stimulated2['abundance'])
stimulated1['abundance']=stimulated1['abundance']/sum_abundance1
stimulated2['abundance']=stimulated2['abundance']/sum_abundance2
merged = merge(x = stimulated1, y = stimulated2, by = "clonotype",all = TRUE)
merged[is.na(merged)] <- 0
return (sum(abs(merged['abundance.x']-merged['abundance.y'])))
}
DISTANCE
EMpredicted1 <- clonoStats(sample1, method = 'EM')
# library(VDJdive)
sample1 <- readVDJcontigs("sample1")
sample2 <- readVDJcontigs("sample2")
EMpredicted <- clonoStats(sample2, method = 'EM')
UNpredicted <- clonoStats(sample2, method = 'unique')
EMpredicted1 <- clonoStats(sample1, method = 'EM')
EMpredicted2 <- clonoStats(sample2, method = 'EM')
DISTANCE=getDistanceEM_UN(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
sample2
library(VDJdive)
sample1 <- readVDJcontigs("sample1")
sample1
sample1$`AAACGGGTCTATCCCG-1`
sample1
sample2
sample2 <- readVDJcontigs("sample2")
sample2
sample2
sample2$`AAAGCAAAGAGCCCAA-1`
sample2
sample2$`AAAGATGCAGGGTACA-1`
sample2[1,]
sample2[,2]
sample2[,3]
sample2[,23]
sample1[,23]
a=sample2[,23]
a
a[1]
a[1,2]
a[1,3]
class(a)
sample3 <- readVDJcontigs("C:/Users/yemin/Downloads/raw_data/raw_data\S1_T")
sample3 <- readVDJcontigs("C:/Users/yemin/Downloads/raw_data/raw_data/S1_T")
sample3
knitr::opts_chunk$set(echo = TRUE)
library(VDJdive)
sample1 <- readVDJcontigs("sample1")
sample2 <- readVDJcontigs("sample2")
EMpredicted1 <- clonoStats(sample1, method = 'EM')
library(VDJdive)
sample1 <- readVDJcontigs("sample1")
sample2 <- readVDJcontigs("sample2")
EMpredicted1 <- clonoStats(sample1, method = 'EM')
UNpredicted1 <- clonoStats(sample1, method = 'unique')
EMpredicted2 <- clonoStats(sample2, method = 'EM')
EMpredicted2 <- clonoStats(sample2, method = 'unique')
DISTANCE=getDistanceTwoSamples(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
knitr::opts_chunk$set(echo = TRUE)
getDistanceTwoSamples<-function(clonotype1,abundance1,clonotype2,abundance2){
stimulated1<- data.frame(clonotype1,abundance1)
stimulated2<- data.frame(clonotype2,abundance2)
colnames(stimulated1) <- c('clonotype','abundance')
colnames(stimulated2) <- c('clonotype','abundance')
sum_abundance1=sum(stimulated1['abundance'])
sum_abundance2=sum(stimulated2['abundance'])
stimulated1['abundance']=stimulated1['abundance']/sum_abundance1
stimulated2['abundance']=stimulated2['abundance']/sum_abundance2
merged = merge(x = stimulated1, y = stimulated2, by = "clonotype",all = TRUE)
merged[is.na(merged)] <- 0
return (sum(abs(merged['abundance.x']-merged['abundance.y'])))
}
DISTANCE=getDistanceTwoSamples(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1])
DISTANCE
DISTANCE=getDistanceTwoSamples(clonoNames(EMpredicted1),clonoAbundance(EMpredicted1)[,1],clonoNames(UNpredicted1),clonoAbundance(UNpredicted1)[,1])
DISTANCE
sample1
sample2
DISTANCE=getDistanceTwoSamples(clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1],clonoNames(UNpredicted2),clonoAbundance(UNpredicted2)[,1])
EMpredicted2 <- clonoStats(sample2, method = 'EM')
UNpredicted2 <- clonoStats(sample2, method = 'unique')
DISTANCE=getDistanceTwoSamples(clonoNames(EMpredicted2),clonoAbundance(EMpredicted2)[,1],clonoNames(UNpredicted2),clonoAbundance(UNpredicted2)[,1])
DISTANCE
