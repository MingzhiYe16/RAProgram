---
title: "RAProject"
author: "Mingzhi Ye"
date: "2022/10/10"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,include = FALSE}
library(VDJdive)
library(tidyverse)
require(SingleCellExperiment)
library(r2r)
library(reticulate)
use_virtualenv('C:/Users/yemin/PycharmProjects/RAProject/venv')
source_python("./main.py")
```



# Calculate distances for samples

```{r,message = FALSE,warning = FALSE}
time0=Sys.time()

getResultTable <- function(PoolSize,SampleSize,Times){
  generateSamplePool(PoolSize)
  
  for(i in 1:Times){
    sample=getSample(PoolSize,SampleSize)
    
    sample$high_confidence<-as.logical(sample$high_confidence)
    sample$productive<-as.logical(sample$productive)
    sample$full_length<-as.logical(sample$full_length)
    sample$is_cell<-as.logical(sample$is_cell)
    
    samplelist <- split(sample, f = sample$barcode)
    samplelist  <- SplitDataFrameList(samplelist)
    
    EMpredicted <- clonoStats(samplelist, method = 'EM')
    updateMergedDataframe(clonoNames(EMpredicted),clonoAbundance(EMpredicted)[,1])
  
    UNpredicted <- clonoStats(samplelist, method = 'unique')
    updateMergedDataframe(clonoNames(UNpredicted),clonoAbundance(UNpredicted)[,1])
    
    
    print(i)
    time1=Sys.time()
    print(time1-time0)
    time0=time1
    
  
  }
  return(getIntermediateResult(Times))
}


Intermediate=getResultTable(20000L,50000L,1L)


```




# Visualize
```{r,eval=FALSE}
boxplot(DistanceListFromEM)
hist(DistanceListFromEM)
boxplot(DistanceListFromUN)
hist(DistanceListFromUN)
print(median(DistanceListFromEM))
print(median(DistanceListFromUN))
print(mean(DistanceListFromEM))
print(mean(DistanceListFromUN))
```

